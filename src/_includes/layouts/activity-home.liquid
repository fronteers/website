{%- assign pageCollectionKey = "published_activities_" | append: locale -%}

{% comment %} Get the title and the information from the next upcoming activity (earliest first) {% endcomment %}
{%- assign upcomingActivitiesForNextUp = collections[pageCollectionKey] | upcomingEvents -%}
{%- for activity in upcomingActivitiesForNextUp limit:1 -%}
    {% comment %} Check if event has happened, or not yet. Create a variable 'eventHasHappened' to store the result. {% endcomment %}
    {%- assign today = "now" | date: "%Y%m%d" | plus: 0 -%}
    {%- assign latestEventDate = activity.data.eventdate | date: "%Y%m%d" | plus: 0 -%}
    {% if today <= latestEventDate %}
        {%- assign eventHasHappened = false -%}
    {% else %}
        {%- assign eventHasHappened = true -%}
    {% endif %}

    {% comment %} Save html in variable nextUpTitle to use on line 38 {% endcomment %}
    {% capture nextUpTitle %}
        <a href="{{ activity.url }}">
            <span class="sup-title">{% if eventHasHappened %}{{ translations[locale].lastEvent }}{% else %}{{ translations[locale].nextEvent }}{% endif %}
            </span>
            <span class="nextup-title">{{ activity.data.title }}</span>
        </a>
    {% endcapture %}

    {% capture nextUp %}<div class="nextup-time-and-location-wrapper">
            {%- if locale == "nl" -%}
                <time class="nextup-time" datetime="{{ activity.data.eventdate | date: "%Y-%m-%d" }}">
                    {{ activity.data.eventdate | eventDate: 'nl', activity.data.eventdateTentative }}
                </time>
            {%- elsif locale == "en" -%}
                <time class="nextup-time" datetime="{{ activity.data.eventdate | date: "%Y-%m-%d" }}">
                    {{ activity.data.eventdate | eventDate: 'en', activity.data.eventdateTentative }}
                </time>
            {%- endif -%}
                
            {% if eventHasHappened %}
                {%- if activity.data.location -%}
                    <span class="nextup-location">
                        {{ activity.data.location }}
                    </span>
                {%- endif -%}
            {%- else -%}
                {%- if activity.data.location -%}
                    <span class="nextup-location">
                        {{ activity.data.location }}
                    </span>
                {%- else -%}
                    <span class="nextup-location">
                        {{ translations[locale].locationUnknown }}
                    </span>
                {%- endif -%}
            {%- endif -%}
        </div>

        <a href="{{ activity.url }}" class="nextup-link" aria-hidden="true">{{ translations[locale].readmore }}<span class="visually-hidden">{{ translations[locale].about }} {{ activity.data.title }}</span></a>
    {% endcapture %}
{%- endfor -%}

{%- include partials/utility/html-head -%}

<body data-layout="activity-home">
    {%- include partials/page-header/_page-header -%}

    <main id="main" class="{% if useHero %}styledheader{% endif %}">
            {% comment %} {%- pagehero 'activities' nextUpTitle nextUp '' -%} {% endcomment %}

        {%- comment -%} Get all upcoming events from the full collection {%- endcomment -%}
        {%- assign allUpcomingActivities = collections[pageCollectionKey] | upcomingEvents -%}
        {%- assign totalUpcoming = allUpcomingActivities | size -%}

        {%- comment -%} Get all categories for filtering {%- endcomment -%}
        {%- assign collectionKey = "activity_categories_" | append: locale -%}
        {%- assign categoryCollection = collections[collectionKey] -%}
        {%- assign categoryCount = categoryCollection | size -%}

        <section class="inner-wrapper upcoming-activities">
            {% comment %}
                // if we decide to use the filters, we need to communicate filtering effects to people with assistive technologies:
                
                <h2 aria-live="polite" aria-atomic="true">{{ translations[locale].upcomingActivitiesTitle }} (<span data-selection-shown>{{ totalUpcoming }}</span> {{ translations[locale].of }} <span>{{ totalUpcoming }}</span> {{ translations[locale].shown }})</h2>
            {% endcomment %}

            <h2>{{ translations[locale].upcomingActivitiesTitle }}</h2>

            <p>
                {{ translations[locale].subscribeToCalendarDescription }}
                <a href="https://calendar.google.com/calendar/ical/qufsujrqggo7umi1glt1k7srik%40group.calendar.google.com/public/basic.ics">{{ translations[locale].subscribeToCalendar }}</a>
            </p>

            {% comment %}
                {%- if categoryCount > 0 -%}
                    <div class="activity-category-filters" data-activity-filters>
                        <details class="category-filters-details">
                            <summary>{{ translations[locale].filter }}
                            </summary>
                            <div class="category-checkboxes">
                                <label>
                                    <input type="checkbox" name="category-filter" value="all" checked data-filter-all>
                                    <span>{{ translations[locale].allCategories }}</span>
                                </label>
                                {%- for category in categoryCollection -%}
                                    <label>
                                        <input type="checkbox" name="category-filter" value="{{ category.slug }}" checked data-filter-category="{{ category.slug }}">
                                        <span>{{ category.title }}</span>
                                    </label>
                                {%- endfor -%}
                            </div>
                        </details>
                    </div>
                {%- endif -%}
            {% endcomment %}

            {%- if totalUpcoming == 0 -%}
                <p>{{ translations[locale].emptyStateActivities }}</p>
            {%- else -%}
                <ol class="activity-calendar-items" data-activity-list>
                    {%- for activity in allUpcomingActivities -%}
                        {%- assign index = forloop.index -%}
                        <li class="list-item" data-activity-item {% for tag in activity.data.categories %}data-category-{{ tag | slugify }}="true" {% endfor %}>
                            {%- include partials/activity-calendar-item headerlvl:"h3" index:index -%}
                        </li>
                    {%- endfor -%}
                </ol>
            {%- endif -%}

            {%- comment -%} Link to past events page {%- endcomment -%}
            {%- assign allPastActivities = collections[pageCollectionKey] | pastEvents -%}
            {%- assign totalPastActivities = allPastActivities | size -%}
            {%- if totalPastActivities > 0 -%}
                <p class="past-events-link">
                    <a href="/{{ translations[locale].activitiesURL }}/{{ translations[locale].pastActivitiesURL }}/">
                        {{ translations[locale].viewPastEvents }} <span>({{ totalPastActivities }})</span>
                    </a>
                </p>
            {%- endif -%}
        </section>

    </main>

    {%- include partials/page-footer/_page-footer -%}
    <script src="/assets/js/activity-filters.js"></script>
</body>
</html>
